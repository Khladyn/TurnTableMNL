@page
@model final_project.Pages.RegistrationModel
@{
}

<body class="h-100">

    <h3 class="text-center text-black mt-5 p-3"> @ViewData["Title"] </h3>

    <div class="container border p-4 col-4 d-flex flex-column mb-5">

    <form method="post" name="registration">

        <fieldset @TempData["Editable"]>

        <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Username class="form-label my-2"></label>
                <input asp-for=@Model.User.Username class="form-control" />
            <span asp-validation-for=@Model.User.Username class="text-danger"></span>
        </div>

                @if (TempData["Error"] != null)
                {
                    <div class="text-danger" role="alert">
                        @TempData["Error"]
                    </div>
                }

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Password class="form-label my-2"></label>
                <input asp-for=@Model.User.Password class="form-control" required />
                <span asp-validation-for=@Model.User.Password class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Repassword class="form-label my-2"></label>
                <input asp-for=@Model.User.Repassword class="form-control" required />
                <span asp-validation-for=@Model.User.Repassword class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Email class="form-label my-2"></label>
                <input asp-for=@Model.User.Email class="form-control" required />
                <span asp-validation-for=@Model.User.Email class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Prefix class="form-label my-2"></label>
                <select asp-for=@Model.User.Prefix class="form-select">
                    <option value="Mr."> Mr. </option>
                    <option value="Ms."> Ms. </option>
                    <option value="Mrs."> Mrs. </option>
                </select>
                <span asp-validation-for=@Model.User.Prefix class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.FirstName class="form-label my-2"></label>
                <input asp-for=@Model.User.FirstName class="form-control" required />
                <span asp-validation-for=@Model.User.FirstName class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.LastName class="form-label my-2"></label>
                <input asp-for=@Model.User.LastName class="form-control" required />
                <span asp-validation-for=@Model.User.LastName class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Address class="form-label my-2"></label>
                <input asp-for=@Model.User.Address class="form-control" required />
                <span asp-validation-for=@Model.User.Address class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.ContactNumber class="form-label my-2"></label>
                <input asp-for=@Model.User.ContactNumber class="form-control" required />
                <span asp-validation-for=@Model.User.ContactNumber class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Birthdate class="form-label my-2"></label>
                <input asp-for=@Model.User.Birthdate class="form-control" required />
                <span asp-validation-for=@Model.User.Birthdate class="text-danger"></span>
            </div>

            <div class="form-group-row d-flex flex-column">
                <label asp-for=@Model.User.Role class="form-label my-2"></label>
                <select asp-for=@Model.User.Role class="form-select">
                    <option value="customer"> Customer </option>
                    <option value="admin"> Admin </option>
                </select>
                <span asp-validation-for=@Model.User.Role class="text-danger"></span>
            </div>

        @{
            Model.User.DateJoined = DateTime.Now;
        }

        </fieldset>

            @if (User.Identity.IsAuthenticated
                        && HttpContext.Request.Query["handler"] == "Edit")
            {
                <div class="mt-4 text-center">
                    <input
                        type="submit"
                        value="Update account" 
                        class="btn btn-primary w-100"
                        asp-page-handler="Update"
                        asp-route-id=@User.Identity.Name />
                </div>

            }
            else if (!User.Identity.IsAuthenticated)
            {
                <div class="mt-4 text-center">
                    <input 
                        type="submit" 
                        value="Create account" 
                        class="btn btn-primary w-100" />
                </div>
        } else {}

        </form>

        @if(User.Identity.IsAuthenticated
                && HttpContext.Request.Query["handler"] == "View")
        {

                <div class="mt-4 text-center">
                    <a
                        asp-page="Registration"
                        asp-page-handler="Edit"
                        asp-route-id=@User.Identity.Name>
                        <button class="btn btn-primary w-100">
                            Edit profile
                        </button>
                    </a>
                </div>

        }
        else if (!User.Identity.IsAuthenticated)
        {
               <div class="mt-2 p-2 text-center">
                     <a asp-page="/Login"> Login </a>
               </div>

        } else {}
    </div>
</body>